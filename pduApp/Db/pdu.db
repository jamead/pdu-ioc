record(bi, "$(P){$(NO)}:conn") {
  field(DTYP, "PSC Ctrl Connected")
  field(INP , "@pscudp$(NO)")
  field(SCAN, "I/O Intr")
  field(ZNAM, "Disconnected")
  field(ONAM, "Connected")
  field(ZSV , "MAJOR")
}

record(bo, "$(P){$(NO)}:reconn") {
  field(DTYP, "PSC Ctrl Reconnect")
  field(OUT , "@pscudp$(NO)")
  field(ZNAM, "Reconnect")
  field(ONAM, "Reconnect")
}


# flush send to socket
record(bo, "$(P){$(NO)}:send") {
  field(DTYP, "PSC Ctrl Send All")
  field(OUT , "@pscudp$(NO)")
  field(ZNAM, "Send")
  field(ONAM, "Send")
}

# writes the UDP packet to the PDU to get status (1Hz)
record(stringout, "$(P){$(NO)}:speak") {
  field(VAL, "Status")        
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")   
  field(FLNK, "$(P){$(NO)}:send")
  #field(SCAN, "1 second")
}


# writes the UDP packet to the PDU
record(stringout, "$(P){$(NO)}Ch1:State-SP") {
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")  
  field(FLNK, "$(P){$(NO)}:send")
}

# writes the UDP packet to the PDU
record(stringout, "$(P){$(NO)}Ch2:State-SP") {
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")  
  field(FLNK, "$(P){$(NO)}:send")
}

# writes the UDP packet to the PDU
record(stringout, "$(P){$(NO)}Ch3:State-SP") {
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")  
  field(FLNK, "$(P){$(NO)}:send")
}

# writes the UDP packet to the PDU
record(stringout, "$(P){$(NO)}Ch4:State-SP") {
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")  
  field(FLNK, "$(P){$(NO)}:send")
}

record(stringout, "$(P){$(NO)}All:On-SP") {
  field(VAL, "ALL-ON")        
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")   
  field(FLNK, "$(P){$(NO)}:send")
}

record(stringout, "$(P){$(NO)}All:Off-SP") {
  field(VAL, "ALL-OFF")        
  field(DTYP, "PSC Block")
  field(OUT , "@pscudp$(NO) 100")   
  field(FLNK, "$(P){$(NO)}:send")
}



## 20 word status from PDU

record(ai, "$(P){$(NO)}Frame:Start-I") {
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 0")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Current:PhaseA-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 4")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Current:PhaseB-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 8")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Current:PhaseC-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 12")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Ch1:Status-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 16")
    field(PINI,"YES")    
    field(VAL ,"16")       
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Ch2:Status-I"){  
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 20") 
    field(PINI,"YES")    
    field(VAL ,"16")        
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Ch3:Status-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 24")
    field(PINI,"YES")    
    field(VAL ,"16")      
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Ch4:Status-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 28")
    field(PINI,"YES")    
    field(VAL ,"16")      
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Rsvd1-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 32")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Rsvd2-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 36")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Temp:Front-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 40")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Temp:Rear-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 44")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Serial:Number-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 48")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Model:Number-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 52")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Firmware:Version-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 56")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Rsvd3-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 60")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Rsvd4-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 64")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Rsvd5-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 68")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Watchdog:Flag-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 72")
    field(SCAN,"I/O Intr")
}

record(ai,"$(P){$(NO)}Frame:End-I"){
    field(DTYP, "PSC Reg F32")
    field(INP , "@pscudp$(NO) 15 76")
    field(SCAN,"I/O Intr")
}



## Parse Ch1:Status
record(calc,"$(P){$(NO)}Ch1:IOC:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch1:Status-I CP")
    field(CALC,"A&1")         # bit 0
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch1:Front:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch1:Status-I CP")
    field(CALC,"(A>>1)&1")    # bit 1
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch1:Rear:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch1:Status-I CP")
    field(CALC,"(A>>2)&1")    # bit 2
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch1:Relay-I"){
    field(INPA,"$(P){$(NO)}Ch1:Status-I CP")
    field(CALC,"(A>>3)&1")    # bit 3
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch1:AuxContactor-I"){
    field(INPA,"$(P){$(NO)}Ch1:Status-I CP")
    field(CALC,"(A>>4)&1")    # bit 4
    field(PREC,"0")
}



## Parse Ch2:Status
record(calc,"$(P){$(NO)}Ch2:IOC:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch2:Status-I CP")
    field(CALC,"A&1")         # bit 0
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch2:Front:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch2:Status-I CP")
    field(CALC,"(A>>1)&1")    # bit 1
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch2:Rear:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch2:Status-I CP")
    field(CALC,"(A>>2)&1")    # bit 2
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch2:Relay-I"){
    field(INPA,"$(P){$(NO)}Ch2:Status-I CP")
    field(CALC,"(A>>3)&1")    # bit 3
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch2:AuxContactor-I"){
    field(INPA,"$(P){$(NO)}Ch2:Status-I CP")
    field(CALC,"(A>>4)&1")    # bit 4
    field(PREC,"0")
}



## Parse Ch3:Status
record(calc,"$(P){$(NO)}Ch3:IOC:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch3:Status-I CP")
    field(CALC,"A&1")         # bit 0
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch3:Front:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch3:Status-I CP")
    field(CALC,"(A>>1)&1")    # bit 1
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch3:Rear:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch3:Status-I CP")
    field(CALC,"(A>>2)&1")    # bit 2
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch3:Relay-I"){
    field(INPA,"$(P){$(NO)}Ch3:Status-I CP")
    field(CALC,"(A>>3)&1")    # bit 3
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch3:AuxContactor-I"){
    field(INPA,"$(P){$(NO)}Ch3:Status-I CP")
    field(CALC,"(A>>4)&1")    # bit 4
    field(PREC,"0")
}


## Parse Ch4:Status
record(calc,"$(P){$(NO)}Ch4:IOC:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch4:Status-I CP")
    field(CALC,"A&1")         # bit 0
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch4:Front:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch4:Status-I CP")
    field(CALC,"(A>>1)&1")    # bit 1
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch4:Rear:Enable-I"){
    field(INPA,"$(P){$(NO)}Ch4:Status-I CP")
    field(CALC,"(A>>2)&1")    # bit 2
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch4:Relay-I"){
    field(INPA,"$(P){$(NO)}Ch4:Status-I CP")
    field(CALC,"(A>>3)&1")    # bit 3
    field(PREC,"0")
}


record(calc,"$(P){$(NO)}Ch4:AuxContactor-I"){
    field(INPA,"$(P){$(NO)}Ch4:Status-I CP")
    field(CALC,"(A>>4)&1")    # bit 4
    field(PREC,"0")
}



